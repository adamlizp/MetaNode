# Blog System API 文档与测试用例

在可执行环境中使用 Postman 或 cURL 等工具验证。

------

## 概览

- **基础 URL**：`http://localhost:8080`（默认端口，可在 `config/config.go` 修改）

- **认证方式**：使用 `Authorization: Bearer <JWT>` 进行鉴权

- **统一响应结构**：

  ```
  {
    "success": true|false,
    "message": "操作成功/错误信息",
    "data": {...},          // 成功时可选
    "error": "错误信息"      // 失败时可选
  }
  ```

------

## 1. 健康检查

| 方法 | 路径      | 认证 |
| ---- | --------- | ---- |
| GET  | `/health` | 无   |

- **响应**：`{ "status": "ok" }`

**测试用例（预期结果）**

1. **请求**：`GET /health` → **状态**：200，**内容**：`{"status":"ok"}`

------

## 2. 用户接口

### 2.1 注册用户

| 方法 | 路径                  | 认证 |
| ---- | --------------------- | ---- |
| POST | `/api/users/register` | 无   |

- **请求体**：`{"username": "...", "password": "...", "email": "..."}`
- **成功响应**：201，`{"success": true, "message": "注册成功"}`
- **失败情况**：参数缺失 400；用户名/邮箱重复等返回 500 且附错误信息

**测试用例（预期结果）**

1. 提供合法 `username/password/email` → 201，消息“注册成功”
2. 省略任一字段 → 400，返回相应验证错误
3. 使用已存在的用户名或邮箱 → 500，错误“用户名已存在”或“邮箱已存在”

### 2.2 用户登录

| 方法 | 路径               | 认证 |
| ---- | ------------------ | ---- |
| POST | `/api/users/login` | 无   |

- **请求体**：`{"username": "...", "password": "..."}`
- **成功响应**：200，`{"success": true, "data": {"token": "<JWT>"}}`
- **失败情况**：参数缺失 400；凭证错误 401，错误“用户名或密码错误”

**测试用例（预期结果）**

1. 正确凭证 → 200，返回 JWT
2. 错误密码 → 401，错误“用户名或密码错误”

### 2.3 获取个人资料

| 方法 | 路径                 | 认证 |
| ---- | -------------------- | ---- |
| GET  | `/api/users/profile` | 必须 |

- **成功响应**：200，`data` 为用户信息
- **失败情况**：缺少/无效 Token → 401

**测试用例（预期结果）**

1. 带有效 JWT → 200，返回当前用户信息
2. 未带或无效 JWT → 401，错误“未授权”

### 2.4 更新个人资料

| 方法 | 路径                 | 认证 |
| ---- | -------------------- | ---- |
| PUT  | `/api/users/profile` | 必须 |

- **请求体**：`{"username": "...", "email": "..."}`
- **成功响应**：200，消息“更新成功”
- **失败情况**：参数缺失 400；用户名/邮箱冲突返回 500；无 Token 401

**测试用例（预期结果）**

1. 合法更新 → 200，“更新成功”
2. 未带 JWT → 401
3. 邮箱已被其他用户使用 → 500，错误“邮箱已存在”

### 2.5 删除用户

| 方法   | 路径             | 认证 |
| ------ | ---------------- | ---- |
| DELETE | `/api/users/:id` | 必须 |

- **说明**：只能删除自己的账号
- **成功响应**：200，消息“账号已删除”
- **失败情况**：未授权 401；删除他人账号 403；ID 非法 400

**测试用例（预期结果）**

1. 使用本人 ID + 有效 JWT → 200，“账号已删除”
2. 尝试删除他人 ID → 403，“没有权限删除其他用户”

------

## 3. 文章接口

### 3.1 获取文章列表

| 方法 | 路径         | 认证 |
| ---- | ------------ | ---- |
| GET  | `/api/posts` | 无   |

- **查询参数**：`page`（默认 1）、`limit`（默认 10）
- **成功响应**：200，`data` 包含 `posts`, `total`, `page`, `limit`

**测试用例（预期结果）**

1. 不带参数 → 返回第一页 10 条
2. `?page=2&limit=5` → 返回对应分页数据

### 3.2 按 ID 获取文章

| 方法 | 路径             | 认证 |
| ---- | ---------------- | ---- |
| GET  | `/api/posts/:id` | 无   |

- **成功响应**：200，返回文章内容
- **失败**：无效 ID 400；不存在 404

**测试用例（预期结果）**

1. 存在的 `id` → 200，返回文章
2. 不存在的 `id` → 404，错误信息

### 3.3 获取某用户的文章

| 方法 | 路径                       | 认证 |
| ---- | -------------------------- | ---- |
| GET  | `/api/posts/user/:user_id` | 无   |

- **查询参数**：`page`, `limit`

**测试用例（预期结果）**

1. 合法 `user_id` → 200，返回用户文章列表
2. 无效 `user_id` → 400

### 3.4 创建文章

| 方法 | 路径         | 认证 |
| ---- | ------------ | ---- |
| POST | `/api/posts` | 必须 |

- **请求体**：`{"title": "...", "content": "..."}`
- **成功响应**：201，“创建成功”
- **失败**：无 Token 401；缺字段 400；用户不存在等 500

**测试用例（预期结果）**

1. 带有效 JWT + 正确字段 → 201，“创建成功”
2. 未带 JWT → 401
3. 缺少 `title` → 400

### 3.5 更新文章

| 方法 | 路径             | 认证 |
| ---- | ---------------- | ---- |
| PUT  | `/api/posts/:id` | 必须 |

- **请求体**：`{"title": "...", "content": "..."}`
- **成功响应**：200，“更新成功”
- **失败**：无 Token 401；非作者操作 500；字段缺失 400

**测试用例（预期结果）**

1. 作者带 JWT 更新 → 200
2. 非作者尝试更新 → 500，“没有权限修改此文章”
3. 未带 JWT → 401

### 3.6 删除文章

| 方法   | 路径             | 认证 |
| ------ | ---------------- | ---- |
| DELETE | `/api/posts/:id` | 必须 |

- **成功响应**：200，“删除成功”
- **失败**：无 Token 401；非作者删除 500；ID 无效 400

**测试用例（预期结果）**

1. 作者带 JWT 删除 → 200
2. 非作者删除 → 500，“没有权限删除此文章”

------

## 4. 评论接口

### 4.1 获取文章评论

| 方法 | 路径                          | 认证 |
| ---- | ----------------------------- | ---- |
| GET  | `/api/comments/post/:post_id` | 无   |

- **查询参数**：`page`, `limit`

**测试用例（预期结果）**

1. 合法 `post_id` → 200，返回评论列表
2. 无效 `post_id` → 400

### 4.2 发表评论

| 方法 | 路径                          | 认证 |
| ---- | ----------------------------- | ---- |
| POST | `/api/comments/post/:post_id` | 必须 |

- **请求体**：`{"content": "..."}`
- **成功响应**：201，“评论成功”
- **失败**：未带 JWT 401；文章不存在 500；参数错误 400

**测试用例（预期结果）**

1. 带 JWT + 合法内容 → 201
2. 未带 JWT → 401
3. `post_id` 不存在 → 500，“文章不存在”

### 4.3 删除评论

| 方法   | 路径                | 认证 |
| ------ | ------------------- | ---- |
| DELETE | `/api/comments/:id` | 必须 |

- **成功响应**：200，“删除成功”
- **失败**：未带 JWT 401；非作者删除 500；ID 无效 400

**测试用例（预期结果）**

1. 作者带 JWT 删除 → 200
2. 非作者删除 → 500，“没有权限删除此评论”